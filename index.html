<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Router vs ElizaOS Baseline: Comprehensive Comparison</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
    <script src="https://unpkg.com/feather-icons"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc;
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .card-hover {
            transition: all 0.3s ease;
            background-color: #ffffff;
            border: 1px solid #e5e7eb;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
        }
        
        .card-hover:hover {
            transform: translateY(-5px);
            box-shadow: 0 14px 32px -6px rgba(0, 0, 0, 0.18);
        }
        
        .metric-card {
            border-left-width: 4px;
        }
        
        .improvement {
            color: #10b981;
        }
        
        .degradation {
            color: #ef4444;
        }
        
        .status-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
        }
        
        .chart-container {
            position: relative;
            height: 300px;
        }
    </style>
</head>
<body class="min-h-screen">
    <div class="gradient-bg text-white">
        <div class="container mx-auto px-4 py-12">
            <div class="max-w-4xl mx-auto text-center" data-aos="fade-up">
                <h1 class="text-4xl font-bold mb-4">Smart Router vs ElizaOS Baseline</h1>
                <p class="text-xl opacity-90">Comprehensive Performance & Cost Comparison</p>
                <div class="mt-6 bg-white bg-opacity-10 rounded-lg px-4 py-2 inline-block">
                    <span id="data-source-info" class="text-sm">Loading data source information...</span>
                </div>
            </div>
        </div>
    </div>

    <div class="container mx-auto px-4 py-8 -mt-16">
        <div id="loading" class="text-center py-20">
            <div class="inline-block animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-purple-500 mb-4"></div>
            <h2 class="text-xl font-medium text-gray-700">Loading benchmark data...</h2>
            <p class="text-gray-500">Please wait while we process the results.</p>
        </div>

        <div id="error" class="hidden bg-red-50 border-l-4 border-red-500 p-4 mb-6 rounded">
            <div class="flex">
                <div class="flex-shrink-0">
                    <svg class="h-5 w-5 text-red-500" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd" />
                    </svg>
                </div>
                <div class="ml-3">
                    <h3 class="text-sm font-medium text-red-800">Error Loading Data</h3>
                    <p id="error-message" class="text-sm text-red-700 mt-1"></p>
                </div>
            </div>
        </div>

        <div id="dashboard" class="hidden">
            <!-- Summary Stats -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                <div class="bg-white rounded-xl shadow-sm p-6 card-hover" data-aos="fade-up">
                    <div class="flex items-center">
                        <div class="p-3 rounded-full bg-blue-50 text-blue-600 mr-4">
                            <i data-feather="activity"></i>
                        </div>
                        <div>
                            <p class="text-sm font-medium text-gray-500">Total Calls</p>
                            <h3 id="total-calls" class="text-2xl font-semibold text-gray-900">-</h3>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white rounded-xl shadow-sm p-6 card-hover" data-aos="fade-up" data-aos-delay="100">
                    <div class="flex items-center">
                        <div class="p-3 rounded-full bg-green-50 text-green-600 mr-4">
                            <i data-feather="clock"></i>
                        </div>
                        <div>
                            <p class="text-sm font-medium text-gray-500">p50 Latency</p>
                            <h3 id="p50-latency" class="text-2xl font-semibold text-gray-900">- <span class="text-sm font-normal">ms</span></h3>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white rounded-xl shadow-sm p-6 card-hover" data-aos="fade-up" data-aos-delay="200">
                    <div class="flex items-center">
                        <div class="p-3 rounded-full bg-purple-50 text-purple-600 mr-4">
                            <i data-feather="check-circle"></i>
                        </div>
                        <div>
                            <p class="text-sm font-medium text-gray-500">Success Rate</p>
                            <h3 id="success-rate" class="text-2xl font-semibold text-gray-900">- <span class="text-sm font-normal">%</span></h3>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white rounded-xl shadow-sm p-6 card-hover" data-aos="fade-up" data-aos-delay="300">
                    <div class="flex items-center">
                        <div class="p-3 rounded-full bg-yellow-50 text-yellow-600 mr-4">
                            <i data-feather="dollar-sign"></i>
                        </div>
                        <div>
                            <p class="text-sm font-medium text-gray-500">Cost per 1k Calls</p>
                            <h3 id="cost-per-1k" class="text-2xl font-semibold text-gray-900">- <span class="text-sm font-normal">USD</span></h3>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Main Dashboard -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                <!-- Performance Comparison -->
                <div class="bg-white rounded-xl shadow-sm p-6 card-hover" data-aos="fade-up">
                    <h2 class="text-xl font-semibold text-gray-800 mb-6 flex items-center">
                        <i data-feather="bar-chart-2" class="mr-2"></i> Performance Metrics
                    </h2>
                    
                    <div class="grid grid-cols-2 gap-4 mb-6">
                        <div class="metric-card bg-gray-50 rounded-lg p-4 border-l-4 border-blue-500">
                            <p class="text-sm font-medium text-gray-500">Baseline p50</p>
                            <h3 id="p50-baseline" class="text-2xl font-semibold text-gray-900">- <span class="text-sm font-normal">ms</span></h3>
                        </div>
                        
                        <div class="metric-card bg-gray-50 rounded-lg p-4 border-l-4 border-green-500">
                            <p class="text-sm font-medium text-gray-500">Smart p50</p>
                            <h3 id="p50-smart" class="text-2xl font-semibold text-gray-900">- <span class="text-sm font-normal">ms</span></h3>
                        </div>
                        
                        <div class="metric-card bg-gray-50 rounded-lg p-4 border-l-4 border-blue-500">
                            <p class="text-sm font-medium text-gray-500">Baseline p95</p>
                            <h3 id="p95-baseline" class="text-2xl font-semibold text-gray-900">- <span class="text-sm font-normal">ms</span></h3>
                        </div>
                        
                        <div class="metric-card bg-gray-50 rounded-lg p-4 border-l-4 border-green-500">
                            <p class="text-sm font-medium text-gray-500">Smart p95</p>
                            <h3 id="p95-smart" class="text-2xl font-semibold text-gray-900">- <span class="text-sm font-normal">ms</span></h3>
                        </div>
                    </div>
                    
                    <div class="chart-container">
                        <canvas id="performanceChart"></canvas>
                    </div>
                </div>

                <!-- Cost Analysis -->
                <div class="bg-white rounded-xl shadow-sm p-6 card-hover" data-aos="fade-up" data-aos-delay="100">
                    <h2 class="text-xl font-semibold text-gray-800 mb-6 flex items-center">
                        <i data-feather="credit-card" class="mr-2"></i> Cost Analysis
                    </h2>
                    
                    <div class="grid grid-cols-2 gap-4 mb-6">
                        <div class="metric-card bg-gray-50 rounded-lg p-4 border-l-4 border-blue-500">
                            <p class="text-sm font-medium text-gray-500">Baseline Cost/1k</p>
                            <h3 id="cost-per-1k-baseline" class="text-2xl font-semibold text-gray-900">- <span class="text-sm font-normal">USD</span></h3>
                        </div>
                        
                        <div class="metric-card bg-gray-50 rounded-lg p-4 border-l-4 border-green-500">
                            <p class="text-sm font-medium text-gray-500">Smart Cost/1k</p>
                            <h3 id="cost-per-1k-smart" class="text-2xl font-semibold text-gray-900">- <span class="text-sm font-normal">USD</span></h3>
                        </div>
                        
                        <div class="metric-card bg-gray-50 rounded-lg p-4 border-l-4 border-blue-500">
                            <p class="text-sm font-medium text-gray-500">Baseline Total</p>
                            <h3 id="total-cost-baseline" class="text-2xl font-semibold text-gray-900">- <span class="text-sm font-normal">USD</span></h3>
                        </div>
                        
                        <div class="metric-card bg-gray-50 rounded-lg p-4 border-l-4 border-green-500">
                            <p class="text-sm font-medium text-gray-500">Smart Total</p>
                            <h3 id="total-cost-smart" class="text-2xl font-semibold text-gray-900">- <span class="text-sm font-normal">USD</span></h3>
                        </div>
                    </div>
                    
                    <div class="chart-container">
                        <canvas id="costChart"></canvas>
                    </div>
                </div>

                <!-- Provider Distribution -->
                <div class="bg-white rounded-xl shadow-sm p-6 card-hover lg:col-span-2" data-aos="fade-up">
                    <h2 class="text-xl font-semibold text-gray-800 mb-6 flex items-center">
                        <i data-feather="pie-chart" class="mr-2"></i> Provider Outcomes
                    </h2>
                    
                    <div class="chart-container">
                        <canvas id="providerChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Statistical Analysis -->
            <div id="statisticalAnalysis" class="hidden bg-white rounded-xl shadow-sm p-6 mb-8 card-hover" data-aos="fade-up">
                <h2 class="text-xl font-semibold text-gray-800 mb-6 flex items-center">
                    <i data-feather="bar-chart" class="mr-2"></i> Statistical Analysis
                </h2>
                
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                    <div class="metric-card bg-gray-50 rounded-lg p-4 border-l-4 border-purple-500">
                        <p class="text-sm font-medium text-gray-500">Confidence Level</p>
                        <h3 id="confidence-level" class="text-2xl font-semibold text-gray-900">- <span class="text-sm font-normal">%</span></h3>
                    </div>
                    
                    <div class="metric-card bg-gray-50 rounded-lg p-4 border-l-4 border-purple-500">
                        <p class="text-sm font-medium text-gray-500">Effect Size</p>
                        <h3 id="effect-size" class="text-2xl font-semibold text-gray-900">-</h3>
                    </div>
                    
                    <div class="metric-card bg-gray-50 rounded-lg p-4 border-l-4 border-purple-500">
                        <p class="text-sm font-medium text-gray-500">Latency P-value</p>
                        <h3 id="p-value-latency" class="text-2xl font-semibold text-gray-900">-</h3>
                    </div>
                    
                    <div class="metric-card bg-gray-50 rounded-lg p-4 border-l-4 border-purple-500">
                        <p class="text-sm font-medium text-gray-500">Cost P-value</p>
                        <h3 id="p-value-cost" class="text-2xl font-semibold text-gray-900">-</h3>
                    </div>
                </div>
            </div>

            <!-- Detailed Comparison -->
            <div class="bg-white rounded-xl shadow-sm p-6 card-hover" data-aos="fade-up">
                <h2 class="text-xl font-semibold text-gray-800 mb-6 flex items-center">
                    <i data-feather="list" class="mr-2"></i> Detailed Comparison
                </h2>
                
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Metric</th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Baseline</th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Smart</th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Δ %</th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Significant</th>
                            </tr>
                        </thead>
                        <tbody id="comparisonBody" class="bg-white divide-y divide-gray-200">
                            <!-- Data will be inserted here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Initialize animations and icons
        AOS.init({
            duration: 800,
            easing: 'ease-in-out',
            once: true
        });
        
        // Global variables
        let comparisonData = null;

        // Load and process data
        async function loadData() {
            try {
                // Check which data is more recent by comparing file timestamps
                let comprehensiveData = null;
                let quickData = null;
                
                // Try to load both datasets with cache-busting
                const timestamp = Date.now();
                try {
                    const comprehensiveResponse = await fetch(`results/comparison-data.json?t=${timestamp}`);
                    if (comprehensiveResponse.ok) {
                        comprehensiveData = await comprehensiveResponse.json();
                    }
                } catch (e) {
                    console.log('Comprehensive comparison data not found');
                }
                
                try {
                    const quickResponse = await fetch(`results/quick-comparison-data.json?t=${timestamp}`);
                    if (quickResponse.ok) {
                        quickData = await quickResponse.json();
                    }
                } catch (e) {
                    console.log('Quick comparison data not found');
                }
                
                // Prioritize comprehensive data if both exist (it's more complete)
                if (comprehensiveData) {
                    comparisonData = comprehensiveData;
                    console.log('Loaded comprehensive data:', comprehensiveData.performance?.latency?.improvement, comprehensiveData.cost?.comparison?.costSavingsPercentage);
                    document.getElementById('data-source-info').textContent = 'Data Source: Comprehensive Comparison Analysis (Latest)';
                    displayComprehensiveData();
                    return;
                } else if (quickData) {
                    comparisonData = quickData;
                    console.log('Loaded quick data:', quickData.performance?.latency?.improvement, quickData.cost?.comparison?.costSavingsPercentage);
                    document.getElementById('data-source-info').textContent = 'Data Source: Quick Benchmark Results';
                    displayComprehensiveData();
                    return;
                }

                throw new Error('No benchmark data found. Please run "npm run bench:comparison" first.');
            } catch (error) {
                console.error('Error loading data:', error);
                showError(error.message);
            }
        }

        function showError(message) {
            document.getElementById('loading').classList.add('hidden');
            document.getElementById('error').classList.remove('hidden');
            document.getElementById('error-message').textContent = message;
        }

        function displayComprehensiveData() {
            document.getElementById('loading').classList.add('hidden');
            document.getElementById('dashboard').classList.remove('hidden');
            document.getElementById('statisticalAnalysis').classList.remove('hidden');

            updateComprehensiveSummaryStats();
            updateComprehensivePerformanceMetrics();
            updateComprehensiveCostAnalysis();
            updateComprehensiveProviderDistribution();
            updateStatisticalAnalysis();
            updateComprehensiveComparisonTable();
            createComprehensiveCharts();
            
            // Replace feather icons
            feather.replace();
        }

        function updateComprehensiveSummaryStats() {
            const performance = comparisonData.performance;
            const cost = comparisonData.cost;
            
            // Calculate total calls from cost data
            const totalCalls = Math.round(cost.baseline.totalEstimatedCost / cost.baseline.costPerCall);
            
            document.getElementById('total-calls').textContent = totalCalls.toLocaleString();
            
            // Use p50 if available, otherwise use mean
            const p50Latency = performance.latency.p50Smart || performance.latency.smart;
            document.getElementById('p50-latency').textContent = Math.round(p50Latency);
            
            document.getElementById('success-rate').textContent = Math.round(performance.successRate.smart * 100);
            
            // Calculate cost per 1k calls
            const costPer1k = (cost.smart.totalActualCost / totalCalls) * 1000;
            document.getElementById('cost-per-1k').textContent = `$${costPer1k.toFixed(6)}`;
        }

        function updateComprehensivePerformanceMetrics() {
            const performance = comparisonData.performance;

            // Use p50 and p95 if available, otherwise fall back to mean
            const p50Baseline = performance.latency.p50Baseline || performance.latency.baseline;
            const p50Smart = performance.latency.p50Smart || performance.latency.smart;
            const p95Baseline = performance.latency.p95Baseline || performance.latency.baseline * 1.5;
            const p95Smart = performance.latency.p95Smart || performance.latency.smart * 1.5;

            document.getElementById('p50-baseline').textContent = Math.round(p50Baseline);
            document.getElementById('p50-smart').textContent = Math.round(p50Smart);
            document.getElementById('p95-baseline').textContent = Math.round(p95Baseline);
            document.getElementById('p95-smart').textContent = Math.round(p95Smart);
        }

        function updateComprehensiveCostAnalysis() {
            const cost = comparisonData.cost;
            
            // Calculate cost per 1k calls
            const totalCalls = Math.round(cost.baseline.totalEstimatedCost / cost.baseline.costPerCall);
            const costPer1kBaseline = (cost.baseline.totalEstimatedCost / totalCalls) * 1000;
            const costPer1kSmart = (cost.smart.totalActualCost / totalCalls) * 1000;

            document.getElementById('cost-per-1k-baseline').textContent = `$${costPer1kBaseline.toFixed(6)}`;
            document.getElementById('cost-per-1k-smart').textContent = `$${costPer1kSmart.toFixed(6)}`;
            document.getElementById('total-cost-baseline').textContent = `$${cost.baseline.totalEstimatedCost.toFixed(4)}`;
            document.getElementById('total-cost-smart').textContent = `$${cost.smart.totalActualCost.toFixed(4)}`;
        }

        function updateComprehensiveProviderDistribution() {
            // This would show which providers were used most frequently
            // Implementation depends on the data structure
        }

        function updateStatisticalAnalysis() {
            const stats = comparisonData.statisticalAnalysis;
            
            if (stats && stats.confidenceLevel) {
                document.getElementById('confidence-level').textContent = `${stats.confidenceLevel}%`;
            } else {
                document.getElementById('confidence-level').textContent = '95%';
            }
            
            if (stats && stats.effectSizes && stats.effectSizes.practicalSignificance) {
                document.getElementById('effect-size').textContent = stats.effectSizes.practicalSignificance;
            } else {
                document.getElementById('effect-size').textContent = '—';
            }
            
            if (stats && stats.significanceTests && stats.significanceTests.latencyImprovement && stats.significanceTests.latencyImprovement.pValue !== undefined) {
                document.getElementById('p-value-latency').textContent = stats.significanceTests.latencyImprovement.pValue.toFixed(4);
            } else {
                document.getElementById('p-value-latency').textContent = '—';
            }
            
            if (stats && stats.significanceTests && stats.significanceTests.costReduction && stats.significanceTests.costReduction.pValue !== undefined) {
                document.getElementById('p-value-cost').textContent = stats.significanceTests.costReduction.pValue.toFixed(4);
            } else {
                document.getElementById('p-value-cost').textContent = '—';
            }
        }

        function updateComprehensiveComparisonTable() {
            const performance = comparisonData.performance;
            const cost = comparisonData.cost;
            const stats = comparisonData.statisticalAnalysis;
            const tbody = document.getElementById('comparisonBody');
            tbody.innerHTML = '';

            // Calculate cost per 1k calls
            const totalCalls = Math.round(cost.baseline.totalEstimatedCost / cost.baseline.costPerCall);
            const costPer1kBaseline = (cost.baseline.totalEstimatedCost / totalCalls) * 1000;
            const costPer1kSmart = (cost.smart.totalActualCost / totalCalls) * 1000;

            const metrics = [
                {
                    name: 'p50 Latency',
                    baseline: `${Math.round(performance.latency.p50Baseline || performance.latency.baseline)}ms`,
                    smart: `${Math.round(performance.latency.p50Smart || performance.latency.smart)}ms`,
                    improvement: calculateDelta(performance.latency.p50Baseline || performance.latency.baseline, performance.latency.p50Smart || performance.latency.smart, false),
                    better: (performance.latency.p50Smart || performance.latency.smart) < (performance.latency.p50Baseline || performance.latency.baseline),
                    significance: stats.significanceTests.latencyImprovement?.pValue ? `p=${stats.significanceTests.latencyImprovement.pValue.toFixed(3)}` : 'N/A'
                },
                {
                    name: 'p95 Latency',
                    baseline: `${Math.round(performance.latency.p95Baseline || performance.latency.baseline * 1.5)}ms`,
                    smart: `${Math.round(performance.latency.p95Smart || performance.latency.smart * 1.5)}ms`,
                    improvement: calculateDelta(performance.latency.p95Baseline || performance.latency.baseline * 1.5, performance.latency.p95Smart || performance.latency.smart * 1.5, false),
                    better: (performance.latency.p95Smart || performance.latency.smart * 1.5) < (performance.latency.p95Baseline || performance.latency.baseline * 1.5),
                    significance: 'No test'
                },
                {
                    name: 'Success Rate',
                    baseline: `${Math.round(performance.successRate.baseline * 100)}%`,
                    smart: `${Math.round(performance.successRate.smart * 100)}%`,
                    improvement: calculateDelta(performance.successRate.baseline * 100, performance.successRate.smart * 100, true),
                    better: performance.successRate.improvement > 0,
                    significance: stats.significanceTests.successRateImprovement?.pValue ? `p=${stats.significanceTests.successRateImprovement.pValue.toFixed(3)}` : 'N/A'
                },
                {
                    name: 'Cost per 1k Calls',
                    baseline: `$${costPer1kBaseline.toFixed(6)}`,
                    smart: `$${costPer1kSmart.toFixed(6)}`,
                    improvement: calculateDelta(costPer1kBaseline, costPer1kSmart, false),
                    better: costPer1kSmart < costPer1kBaseline,
                    significance: (stats.significanceTests.costReduction?.pValue !== undefined && stats.significanceTests.costReduction?.pValue !== null) ? `p=${stats.significanceTests.costReduction.pValue.toFixed(3)}` : 'N/A'
                },
                {
                    name: 'Total Cost',
                    baseline: `$${cost.baseline.totalEstimatedCost.toFixed(4)}`,
                    smart: `$${cost.smart.totalActualCost.toFixed(4)}`,
                    improvement: calculateDelta(cost.baseline.totalEstimatedCost, cost.smart.totalActualCost, false),
                    better: cost.smart.totalActualCost < cost.baseline.totalEstimatedCost,
                    significance: (stats.significanceTests.costReduction?.pValue !== undefined && stats.significanceTests.costReduction?.pValue !== null) ? `p=${stats.significanceTests.costReduction.pValue.toFixed(3)}` : 'N/A'
                }
            ];

            metrics.forEach(metric => {
                const row = document.createElement('tr');
                const deltaClass = metric.improvement.includes('+') ? 'improvement' : 
                                 metric.improvement.includes('-') ? 'degradation' : '';
                const statusClass = metric.better ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800';
                const statusText = metric.better ? 'Better' : 'Worse';
                
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${metric.name}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${metric.baseline}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${metric.smart}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm ${deltaClass}">${metric.improvement}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm">
                        <span class="status-badge ${statusClass}">${statusText}</span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${metric.significance}</td>
                `;
                tbody.appendChild(row);
            });
        }

        function calculateDelta(baseline, smart, higherIsBetter) {
            if (!baseline || baseline === 0) return '—';
            
            const diff = smart - baseline;
            const percent = (diff / baseline) * 100;
            
            const sign = percent > 0 ? '+' : '';
            return `${sign}${percent.toFixed(1)}%`;
        }

        function createComprehensiveCharts() {
            createComprehensivePerformanceChart();
            createComprehensiveCostChart();
            createComprehensiveProviderChart();
        }

        function createComprehensivePerformanceChart() {
            const ctx = document.getElementById('performanceChart').getContext('2d');
            const performance = comparisonData.performance;
            
            // Use p50 and p95 if available, otherwise fall back to mean
            const p50Baseline = performance.latency.p50Baseline || performance.latency.baseline;
            const p50Smart = performance.latency.p50Smart || performance.latency.smart;
            const p95Baseline = performance.latency.p95Baseline || performance.latency.baseline * 1.5;
            const p95Smart = performance.latency.p95Smart || performance.latency.smart * 1.5;
            
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Baseline', 'Smart Router'],
                    datasets: [
                        {
                            label: 'p50 Latency (ms)',
                            data: [Math.round(p50Baseline), Math.round(p50Smart)],
                            backgroundColor: ['#3b82f6', '#10b981'],
                            borderColor: ['#2563eb', '#059669'],
                            borderWidth: 1
                        },
                        {
                            label: 'p95 Latency (ms)',
                            data: [Math.round(p95Baseline), Math.round(p95Smart)],
                            backgroundColor: ['#93c5fd', '#6ee7b7'],
                            borderColor: ['#3b82f6', '#10b981'],
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Latency (ms)'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }

        function createComprehensiveCostChart() {
            const ctx = document.getElementById('costChart').getContext('2d');
            const cost = comparisonData.cost;
            
            // Calculate cost per 1k calls
            const totalCalls = Math.round(cost.baseline.totalEstimatedCost / cost.baseline.costPerCall);
            const costPer1kBaseline = (cost.baseline.totalEstimatedCost / totalCalls) * 1000;
            const costPer1kSmart = (cost.smart.totalActualCost / totalCalls) * 1000;
            
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Baseline', 'Smart Router'],
                    datasets: [{
                        label: 'Cost per 1k Calls (USD)',
                        data: [costPer1kBaseline, costPer1kSmart],
                        backgroundColor: ['#3b82f6', '#10b981'],
                        borderColor: ['#2563eb', '#059669'],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'USD per 1,000 calls'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
        }

        function createComprehensiveProviderChart() {
            const ctx = document.getElementById('providerChart').getContext('2d');
            const providers = comparisonData.providerEfficiency.smart;
            
            // Filter out non-provider entries
            const filteredProviders = {};
            Object.keys(providers).forEach(key => {
                if (key !== 'failed' && key !== 'error' && key !== 'unknown' && key !== '[object Object]') {
                    filteredProviders[key] = providers[key];
                }
            });
            
            const labels = Object.keys(filteredProviders);
            const successData = labels.map(label => filteredProviders[label].successfulCalls || filteredProviders[label].calls * 0.8);
            const failureData = labels.map(label => filteredProviders[label].failedCalls || filteredProviders[label].calls * 0.2);
            
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Success',
                            data: successData,
                            backgroundColor: '#10b981',
                            borderColor: '#059669',
                            borderWidth: 1
                        },
                        {
                            label: 'Failure',
                            data: failureData,
                            backgroundColor: '#ef4444',
                            borderColor: '#dc2626',
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            stacked: true
                        },
                        y: {
                            stacked: true,
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Number of Calls'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }

        // Initialize the dashboard with cache-busting
        document.addEventListener('DOMContentLoaded', function() {
            // Force reload by adding cache-busting parameter
            const urlParams = new URLSearchParams(window.location.search);
            if (!urlParams.has('v')) {
                urlParams.set('v', Date.now());
                window.history.replaceState({}, '', `${window.location.pathname}?${urlParams.toString()}`);
            }
            loadData();
        });
    </script>
</body>
</html>